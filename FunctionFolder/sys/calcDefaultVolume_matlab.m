function vol = calcDefaultVolume(numIons, atomType, targetPressure, isMol)



%%===============================================
moleculeType=[1 6 7 8 9 15 16 17 33 34 35 52 53];



atomicVolume=zeros(1, length(atomType));
for i = 1:length(atomType)
     if (sum(moleculeType==atomType(i))*isMol ) > 0
        atomicVolume(i) = moleculeVolume( targetPressure, atomType(i) );
     else
        atomicVolume(i) = elementVolume( targetPressure, atomType(i) );
     end
end


vol = sum(numIons.*atomicVolume);


end


%%===============================================================================
function targetVolume = elementVolume(targetPress, atomType)


fitParameter=[ ...
    %%   atomType     B0           B0'        V at 0GPa    V at 500GPa
            1       95.351       4.2509         2.89       1.1577
            2      0.49753       7.2994        17.97         1.92
            3       15.083       3.7931        20.12         3.13
            4       114.38       3.8594         7.84         3.17
            5       234.19       3.8984         6.16          3.2
            6       166.74       4.5885         6.73         3.36
            7        184.7       4.1746         7.21         3.57
            8       152.02       4.8325         7.75         3.85
            9       55.289       5.7781        9.925         4.04
           10       2.2859       7.7833       20.295         4.23
           11        5.661       5.1166        36.62         5.54
           12       28.819       4.9293        22.87         6.58
           13       62.769       4.8142        17.01         6.37
           14       78.151       4.9326        14.85         6.08
           15       79.673       4.9989         14.3         5.94
           16       84.499       4.1642        15.74         5.95
           17       38.801       4.6922        21.24         6.54
           18       1.3785       7.3146        47.21         7.48
           19     0.054489       9.8419        73.51         7.34
           20       2.4553       6.5773        42.21         6.92
           21       33.001        4.272        24.76         6.56
           22          147       1.9653        16.92         5.22
           23       222.72       2.7892        13.21         5.93
           24        282.2       3.9337        11.37         6.27
           25       289.36       4.4905        10.67         6.17
           26       272.91       4.7434        10.45         6.05
           27       234.76       5.1307        10.52         6.01
           28       198.31       5.2294        10.87         5.99
           29       126.91       5.7014        12.03         6.12
           30       58.971       6.0245        15.42         6.57
           31       43.538       5.9453         19.1         7.39
           32        56.04       5.7091        19.26         7.81
           33       70.008       5.4126        18.97         7.95
           34       68.629       5.1074        20.28         8.14
           35       28.715       5.5105        26.65         8.49
           36       1.4751       7.2474        57.87         9.24
           37     0.054586       9.9498        90.42         9.29
           38        1.239       7.8273        53.19         9.19
           39       14.711       5.9579        32.92         9.02
           40       156.99        4.373        18.06         8.67
           41       108.85       2.0182        22.82         5.96
           42       281.34        4.009        15.59         8.64
           43       307.23       4.4579        14.62         8.57
           44       283.74       4.8786        14.28         8.42
           45       230.82       5.3657        14.55          8.4
           46       163.21       5.8392        15.48         8.47
           47       81.667       6.4532        18.08         8.73
           48       35.645       6.7511        23.12         9.26
           49       28.333       6.2559        28.09         9.94
           50       39.875       6.0926        27.44        10.53
           51       48.231       5.8466        27.25        10.74
           52       47.471       5.6133        28.47        10.85
           53       20.759       5.8933        35.81        10.89
           54       0.7982       7.9642        78.67        12.06
           55     0.038483       10.361       116.19        11.85
           56      0.88659       8.8616        63.55        12.18
           57       10.752       6.7103        37.57        10.54
           58       33.765       6.4636        26.31        10.05
           59       37.211          7.3        22.82         9.75
           60       45.533       7.5605         20.7         9.49
           61       45.533       7.5605         20.7         9.49  %% cite from 60
           62       45.533       7.5605         20.7         9.49  %% cite from 60
           63       45.533       7.5605         20.7         9.49  %% cite from 60
           64       45.533       7.5605         20.7         9.49  %% cite from 60
           65       11.801       6.7032        32.74         9.47
           66       12.543         6.58        32.27         9.33
           67       14.335       6.3273        31.77          9.2
           68        16.16       6.0962        31.23         9.05
           69        16.16       6.0962        31.23         9.05  %% cite from 68
           70       7.7108       6.1463        37.54         8.49
           71       17.962       5.8809        30.71         8.88
           72       126.78       2.4187        22.01         7.06
           73        202.1       3.5892        18.12         8.69
           74       314.74        4.192        15.92         9.23
           75       369.26       4.5413        15.02         9.27
           76       361.68        4.956        14.74         9.25
           77       307.15        5.218        15.07         9.23
           78       237.93       5.6629        15.84         9.37
           79       134.91       6.2043        18.13         9.71
           80       13.303       8.0795        28.93        10.35
           81       26.004       5.9318         31.2        10.27
           82       30.124       6.2493        31.88        11.48
           83       41.332       5.8632        31.83           12
           84       11.467       6.2222        45.76        12.06  %% cite from 89
           85       11.467       6.2222        45.76        12.06  %% cite from 89
           86       11.467       6.2222        45.76        12.06  %% cite from 89
           87       11.467       6.2222        45.76        12.06  %% cite from 89
           88       11.467       6.2222        45.76        12.06  %% cite from 89
           89       11.467       6.2222        45.76        12.06
           90       34.478       5.8423        32.55        11.58
           91       69.983       5.8464        24.72        10.85
           92       116.67       6.0538        20.17        10.32
           93       168.74       6.1916         17.6         9.92
           94       197.72       6.3627        16.42         9.68
];

    i=atomType;

    
    if targetPress > 500
        volumeRange=fitParameter(i,5)/2:0.02:fitParameter(i,5);
    else
        volumeRange=fitParameter(i,5):0.05:fitParameter(i,4);
    end
    
    tryn=1;
    for tryVolume0=volumeRange
       tryVolume(tryn)=tryVolume0;
       tryPressure(tryn)= VintEOS( fitParameter(i,2), fitParameter(i,3), fitParameter(i,4), tryVolume0 );
       tryn=tryn+1;
    end
    [nothing,whichOne]=min(abs(tryPressure-targetPress));
    targetVolume=tryVolume(whichOne);

end


function targetVolume = moleculeVolume(targetPress, atomType)


fitParameter=[ ...
    %%   atomType     B0           B0'        V at 0GPa    V at 500GPa
            1       8.9372       4.7784         7.01       1.1796
            6       21.644       6.6553        10.58         3.64
            7       229.77        3.342         7.07         3.46
            8       9.1434       7.2715        13.48         3.93
            9       1.9817       8.3349        18.39         4.06
           15       90.811       3.6419        16.29         5.79
           16        4.477       6.6071        29.43         6.04
           17       3.8971       6.4659        34.77         6.56
           33       53.119       4.8589        22.46         7.98
           34       6.8945       7.1877        31.44         8.31
           35       4.5341       7.0373        37.53         8.45
           52       10.385       6.9714        38.46        11.13
           53       2.8198       7.6306        50.34        10.89
];

    i=find( (fitParameter(:,1)==atomType )>0);

    
    if targetPress > 500
        volumeRange=fitParameter(i,5)/2:0.02:fitParameter(i,5);
    else
        volumeRange=fitParameter(i,5):0.05:fitParameter(i,4);
    end
    
    tryn=1;
    for tryVolume0=volumeRange
       tryVolume(tryn)=tryVolume0;
       tryPressure(tryn)= VintEOS( fitParameter(i,2), fitParameter(i,3), fitParameter(i,4), tryVolume0 );
       tryn=tryn+1;
    end
    [nothing,whichOne]=min(abs(tryPressure-targetPress));
    targetVolume=tryVolume(whichOne);

end

%%

function P=VintEOS(B0,B00,V0,x)

%%  fit the Volume with the Vint-EOS
%%
%%  B00 = B0'

P=3*B0*( (1-(x/V0)^(1/3) )/ ((x/V0)^(2/3)) )*exp(1.5*(B00-1)*((1-(x/V0)^(1/3))));

end